/////////////////////////////////////
// Timeline
/////////////////////////////////////
@import (reference, multiple) "../font/icon-names";
@import "../variables/global";

@solid: 1px solid @text;
@dashed: 1px dashed @timeline-dot-default;

.timeline{
    width:100%;
    height: 100%;
    position: relative;

    *{
      line-height: 1.5em;
    }

    ul{
        padding: 0;
        list-style: none;
        flex-direction: column;
        display: flex;
    }

    .iconColor(severity-critical, @red);
    .iconColor(severity-major, @orange);
    .iconColor(severity-minor, @yellow);
    .iconColor(severity-warning, @blue);
    .iconColor(severity-indeterminate, @gray);
    .iconColor(severity-cleared, @green);
    .iconColor(alarm-level6, @red);
    .iconColor(alarm-level5, @orange);
    .iconColor(alarm-level4, @yellow);
    .iconColor(alarm-level3, @blue);
    .iconColor(alarm-level2, @gray);
    .iconColor(alarm-level1, @green);

    .iconColor(@name, @color){
        .icon-@{name}{
            &::before{
                color: @color;
            }
        }
    }

    // ::before{
    //     .icon(); // undefined
    // }

    :focus{
        outline: 1px solid @purple;
        outline-offset: 2px;
    }

    .main-list{
        overflow: auto;
        height: 100%;
        width: 100%;

        &:not(.headings){
            .entry{
                &:last-of-type{
                    &::after{
                        content: none;
                    }
                }
            }
        }
    }

    .entry{
        padding: 0;
        position: relative;

        &::before{
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2;
            border:solid 1px @timeline-dot-default;
            border-radius: 50%;
        }

        &::after{
            position: absolute;
            content: ''; 
            z-index: 1;
        }

        .target{
            border: solid 1px transparent;
            margin: 3px;
            min-width: 250px;
        }

        .time{
            display:block;
            font-size: 0.75rem;
            color: @gray-text;
            margin: 0 0 0.5rem;
        }
    
        .title{
            margin: 0;
        }

        .status{
            margin: 0.5rem 0 0;
            height: 1.5em;
            display: block;
            color: @gray-text;

            span{
                margin: 0 0.5rem 0 0;

                &::before{
                    margin: 0 0.25rem 0 0;
                }
            }
        }

        .content {
            margin: 0.25rem 0 0;
        }

        .collapse-btn{
            position: absolute;
            right: 1rem;
            width: 1.5rem;
            height: 1.5rem;
            border: 0;
            padding: 0;
            background: transparent;
            cursor: pointer;
            font-size: 1rem;

            &::before{
                content: @icon-chevron-up;
            }
        }

        &[class*=icon]{
            &::before{
                width: 22px;
                height: 22px;
                color: @text;
                background: @timeline-icon-background;
            }
        }

        &:not([class*=icon]){
            &::before{
                content: '';
                width: 8px;
                height: 8px;
                margin: 7px;
                background: @timeline-dot-default;
            }
        }

        &.scheduled{
            &::before{
                background: @layer2;
            }
        }

        &.collapsed{
            .content,
            ul{
                display: none;
            }

            .collapse-btn{
                &::before{
                    content: @icon-chevron-down;
                }
            }
        }
    }

    .headings{
        .date-group{
            padding: 0;
    
            &:last-of-type{
                & > .entry-list{
                    & > .entry{
                        &:last-of-type{
                            &::after{
                                content: none;  
                            }
                        }
                    }
                }
            }
        }

        .heading{
            position: relative;
            width: 100%;

            .label{
                position: absolute;
                left: 0;
                border: solid 1px @gray-140;
                border-radius: 3px;
                padding: 6px 8px;
                background: @timeline-heading-background;
                display:block;
                z-index: 2;
                opacity: 1;
                transition: opacity 0.3s;
            }
        }

        .timeline-sticky {
            & > .heading {
                position: static;
            }
        }

        .fade{
            .heading{
                .label{
                    opacity: 0
                }
            }
        }
    }

    &.compact,
    &:not(.horizontal){
        .main-list{
            padding-right: 1rem;
        }

        .entry,
        .heading{
            &::after{
                border-left: @solid;
            }
    
            &.to-scheduled,
            &.scheduled{
                &::after{
                    border-left: @dashed;
                }
            }
        }

        .entry{
            & > ul {
                margin: 0 0 0 2.5rem;
            }
            
            &::before{
                left: 0.5rem;
                top: 1rem;
            }

            &::after{
                left: 1.25rem;
                top: 1.5rem;
                height: 100%;
            }

            .target{
                padding: 1rem 1rem 1rem 2.25rem;
            }

            .collapse-btn{
                top: 1rem;
            }
        }

        .date-group{
            flex-shrink: 0; // IE 11

            .heading{
                height: 3rem;

                .label{
                    margin: 0.5rem 0;
                    width: 100%;
                    top: 0;
                }
            }

            & + .date-group{
                & > .heading {
                    &::after{
                        content: '';
                        position: relative;
                        display:inline-block;
                        left: 1.25rem;
                        height: 3rem;
                        margin-top: 1.5rem;
                        z-index: 1;
                    }
                }
            }

            &.timeline-sticky{
                & > .heading{
                    .label{
                        width: calc(100% - 1rem);
                        z-index: 3;
                    }
                }
            }
        }
    }

    &.horizontal:not(.compact){
        ul{
            flex-direction: row;
        }

        .main-list{
            padding-bottom: 1rem;
        }

        .heading{
            display: inline-block;
            margin: 0 0 0.5rem;
            height: 2rem;

            &::after{
                content: none;
            }
        }
    
        .entry{
            & > ul {
                margin: 0.5rem 0 0 0;
            }

            &::before{
                left: 0.875rem;
                top: 0.3125rem;
            }

            &::after{
                width: 100%;
                left: 1.5rem;
                top: 1rem;
                border-top: @solid;
            }

            .target{
                padding: 2.25rem 1rem 1rem 1rem;
            }

            .collapse-btn{
                top: 2.25rem;
            }
    
            &.to-scheduled,
            &.scheduled{
                &::after{
                    border-top: @dashed;
                }
            }

            .entry{ // IE 11
                flex-basis: 250px;
                flex-grow: 1;
            }

        }

        .entry-list{ // IE 11
            display:block;

            .entry-list{
                display: flex;
            }
        }
    }

    .selectable{
        .entry{
            .target{
                cursor:pointer;

                &:hover{
                    background: @menu-item-background-hover;

                    .time{
                        color: @text;
                    }
                }
            }

            &.active{
                &::before{
                    color: @blue;
                    border-color: @blue;
                }

                & > .target{
                    border: solid 1px @blue;
                }

                &:not([class*=icon]){
                    &:not(.scheduled){
                        &::before{
                            background: @blue;
                        }
                    }
                }
            }

            &.scheduled{
                &:hover{
                    &::before{
                        background: @menu-item-background-hover;
                    }
                }
            }
        }
    }
}