/**
 * Calculate linear regression coefficients using the method of least squares.
 * Linear regression equation: y = ax + b
 * @private
 * @param {Array} data
 * @return {Array} - Coefficients a, b and R-squared value
 */
export function regressionLinear(data) {
  const xValues = data.map(d => d.x);
  const yValues = data.map(d => d.y);

  if (!xValues.length || !yValues.length) {
    return [];
  }

  const reduceSumFunc = (prev, cur) => (prev + cur);

  const xBar = xValues.reduce(reduceSumFunc) * 1.0 / xValues.length;
  const yBar = yValues.reduce(reduceSumFunc) * 1.0 / yValues.length;

  const ssXX = xValues.map((d) => Math.pow(d - xBar, 2)).reduce(reduceSumFunc);
  const ssYY = yValues.map((d) => Math.pow(d - yBar, 2)).reduce(reduceSumFunc);
  const ssXY = xValues.map((d, i) => (d - xBar) * (yValues[i] - yBar)).reduce(reduceSumFunc);

  const slope = ssXY / ssXX;
  const intercept = yBar - (xBar * slope);
  const rSquare = Math.pow(ssXY, 2) / (ssXX * ssYY);

  return [slope, intercept, rSquare];
}
